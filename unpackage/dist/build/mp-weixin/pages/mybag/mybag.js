(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/mybag/mybag"],{"1cec":function(e,t,o){"use strict";var n=o("8a1f"),a=o.n(n);a.a},2012:function(e,t,o){"use strict";o.r(t);var n=o("a3b2"),a=o.n(n);for(var i in n)"default"!==i&&function(e){o.d(t,e,(function(){return n[e]}))}(i);t["default"]=a.a},5368:function(e,t,o){"use strict";var n,a=function(){var e=this,t=e.$createElement;e._self._c;e._isMounted||(e.e0=function(t){e.authAgain=!1},e.e1=function(t){e.txSuc=!1},e.e2=function(t){e.txAttention=!1})},i=[];o.d(t,"b",(function(){return a})),o.d(t,"c",(function(){return i})),o.d(t,"a",(function(){return n}))},"562f":function(e,t,o){"use strict";o.r(t);var n=o("5368"),a=o("2012");for(var i in a)"default"!==i&&function(e){o.d(t,e,(function(){return a[e]}))}(i);o("1cec");var r,s=o("f0c5"),c=Object(s["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],r);t["default"]=c.exports},"8a1f":function(e,t,o){},a3b2:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(o("4795"));function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t,o,n,a,i,r){try{var s=e[i](r),c=s.value}catch(l){return void o(l)}s.done?t(c):Promise.resolve(c).then(n,a)}function r(e){return function(){var t=this,o=arguments;return new Promise((function(n,a){var r=e.apply(t,o);function s(e){i(r,n,a,s,c,"next",e)}function c(e){i(r,n,a,s,c,"throw",e)}s(void 0)}))}}function s(e,t){return u(e)||p(e,t)||l(e,t)||c()}function c(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function l(e,t){if(e){if("string"===typeof e)return d(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(o):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?d(e,t):void 0}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=new Array(t);o<t;o++)n[o]=e[o];return n}function p(e,t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e)){var o=[],n=!0,a=!1,i=void 0;try{for(var r,s=e[Symbol.iterator]();!(n=(r=s.next()).done);n=!0)if(o.push(r.value),t&&o.length===t)break}catch(c){a=!0,i=c}finally{try{n||null==s["return"]||s["return"]()}finally{if(a)throw i}}return o}}function u(e){if(Array.isArray(e))return e}var h={data:function(){return{imgUrl:getApp().globalData.imgUrl,provinceCode:getApp().globalData.provinceCode,totalMoney:0,total:0,giftsMoney:0,haveTel:this.$Store.state.haveTel,txSuc:!1,txAttention:!1,txMoney:0,isOnLoad:!1,needTx:!1,showPrivacy:!1,sharePath:"",shareImg:"https://xcxsite.vjifen.com/v/static/qp2020/share.png",authAgain:!1,gzhName:this.$Store.state.gzhName?this.$Store.state.gzhName:""}},onLoad:function(e){console.log(e),e.provinceCode&&(this.provinceCode=e.provinceCode,getApp().globalData.provinceCode=e.provinceCode,this.$Store.commit("setProjectSign",e.provinceCode),this.sharePath="pages/mybag/mybag?provinceCode="+this.provinceCode,console.log(this.$Store.state.requestUrl,this.$Store.state.appid,this.$Store.state.payAppid),this.gzhName=this.$Store.state.gzhName,this.isOnLoad=!0)},onShow:function(){var t=this;e.getStorage({key:"readPrivacy"}).then((function(e){console.log("readPrivacy",e);var o=s(e,2),n=(o[0],o[1]);n||(t.showPrivacy=!0)})),this.isOnLoad?this.checkProvinceCode().then((function(o){if(console.log("省区关系是否变更",o),!o){getApp().globalData.openid="",getApp().globalData.hbopenid="";try{e.removeStorageSync("openid"),e.removeStorageSync("hbopenid")}catch(n){}}t.init()})):this.init(),this.needTx&&(this.needTx=!1,this.giveSpack())},methods:{readPrivacy:function(){this.showPrivacy=!1,e.setStorage({key:"readPrivacy",data:!0,complete:function(e){console.log("setReadPrivacy",e)}})},init:function(){var t=this;!getApp().globalData.openid&&this.provinceCode?(this.sharePath="pages/mybag/mybag?provinceCode="+this.provinceCode,this.$Store.dispatch("getOpenid").then((function(o){var n=s(o,2),a=n[0],i=n[1];i?(e.showLoading({title:"加载中"}),getApp().globalData.openid=i.data.openid,t.queryAllGiftsList()):(console.log(a),e.navigateTo({url:"../tool/getOpenid/getOpenid?type=openid"}))}))):getApp().globalData.openid?(this.sharePath="pages/mybag/mybag?provinceCode="+this.provinceCode,e.showLoading({title:"加载中"}),this.queryAllGiftsList()):this.provinceCode||this.getProvinceCode().then((function(o){if(!o||void 0==o||"undefined"==o)return!1;t.provinceCode=o,getApp().globalData.provinceCode=o,e.setStorage({key:"provinceCode",data:t.provinceCode}),t.sharePath="pages/mybag/mybag?provinceCode="+t.provinceCode,t.$Store.commit("setProjectSign",o),t.gzhName=t.$Store.state.gzhName,t.$Store.dispatch("getOpenid").then((function(o){var n=s(o,2),a=n[0],i=n[1];i?(e.showLoading({title:"加载中"}),getApp().globalData.openid=i.data.openid,t.queryAllGiftsList()):(console.log(a),e.navigateTo({url:"../tool/getOpenid/getOpenid?type=openid"}))}))}))},toStrcode:function(){console.log(this.provinceCode),e.navigateTo({url:"../scan/strcode?provinceCode="+this.provinceCode})},toDetails:function(){e.navigateTo({url:"./details"})},toPrivacy:function(){e.navigateTo({url:"../rule/privacy"})},toLx:function(){console.log(this.$Store.state.vjfAppid),e.navigateTo({url:"../yylx/hgList"})},getProvinceCode:function(){var t=this;return r(n.default.mark((function o(){var a,i;return n.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(a={},getApp().globalData.xcxOpenid){o.next=8;break}return o.next=4,t.$Store.dispatch("getXcxOpenid");case 4:a=o.sent,getApp().globalData.xcxOpenid=a.openid,getApp().globalData.sessionKey=a.session_key,e.setStorage({key:"xcxOpenid",data:a});case 8:return o.next=10,t.$Store.dispatch("getProvinceCode",getApp().globalData.xcxOpenid);case 10:return i=o.sent,console.log(i),o.abrupt("return",i);case 13:case"end":return o.stop()}}),o)})))()},checkProvinceCode:function(){var t=this;return r(n.default.mark((function o(){var a,i;return n.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(a={},getApp().globalData.xcxOpenid){o.next=8;break}return o.next=4,t.$Store.dispatch("getXcxOpenid");case 4:a=o.sent,getApp().globalData.xcxOpenid=a.openid,getApp().globalData.sessionKey=a.session_key,e.setStorage({key:"xcxOpenid",data:a});case 8:return o.next=10,t.$Store.dispatch("getProvinceCode",getApp().globalData.xcxOpenid);case 10:if(i=o.sent,console.log(i),i==t.provinceCode||void 0==t.provinceCode){o.next=18;break}return e.request({url:"".concat(t.$Store.state.isOnline?t.$Store.state.online.sgUrl:t.$Store.state.test.sgUrl,"/api/queryProvinceCode"),method:"GET",data:{xcxopenid:a.openid,provinceCode:t.provinceCode},complete:function(e){console.log("redis",e)}}),e.setStorage({key:"provinceCode",data:t.provinceCode}),o.abrupt("return",!1);case 18:return e.setStorage({key:"provinceCode",data:t.provinceCode}),o.abrupt("return",!0);case 20:case"end":return o.stop()}}),o)})))()},getOpenid:function(){var t=this;return r(n.default.mark((function o(){var a;return n.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,t.$Store.dispatch("getXcxOpenid");case 2:return a=o.sent,e.setStorage({key:"xcxOpenid",data:a}),o.abrupt("return",a);case 5:case"end":return o.stop()}}),o)})))()},tx:function(){var t=this;e.showLoading({title:"提现中"}),e.request({url:this.$Store.state.requestUrl+"/gifts/getGiftspack",method:"POST",data:{openid:getApp().globalData.openid,hbopenid:getApp().globalData.hbopenid,phoneNumber:this.$Store.state.haveTel,headimgurl:this.$Store.state.hasUserInfo?this.$Store.state.userInfo.avatarUrl:"",nickname:this.$Store.state.hasUserInfo?this.$Store.state.userInfo.nickName:"",sex:this.$Store.state.hasUserInfo?this.$Store.state.userInfo.gender:"",projectServerName:this.$Store.state.serverName}}).then((function(o){e.hideLoading();var n=s(o,2),a=n[0],i=n[1];console.log("提现",o),i?0==i.data.result.code?0==i.data.result.businessCode?(t.txMoney=i.data.reply.withdrawMoney,t.queryAllGiftsList(),t.queryAttention()):1==i.data.result.businessCode?e.showModal({title:"提现提示",content:"您的红包金额不足，再喝几瓶攒够1元发红包！",showCancel:!1}):2==i.data.result.businessCode?e.showModal({title:"提现提示",content:"系统开了个小差",showCancel:!1}):3==i.data.result.businessCode?e.showModal({title:"提现提示",content:"根据国家法规对支付服务实名制的要求，请到微信中进行实名认证\n实名认证方法：进入【微信】->【我】->【钱包】->【···】->【支付管理】，即可实名认证。",showCancel:!1}):4==i.data.result.businessCode?e.showModal({title:"提现提示",content:"提现处理中，请稍后查看详细记录",showCancel:!1}):-2==i.data.result.businessCode?e.showModal({title:"提现提示",content:"操作频繁，稍作歇息",showCancel:!1}):-1==i.data.result.businessCode?e.showModal({title:"提现提示",content:"系统升级中，稍后再试",showCancel:!1}):e.showModal({title:"提现接口提示",content:i.data.result.msg?i.data.result.msg:"系统开了个小差，请稍后再试~",showCancel:!1}):e.showModal({title:"提现接口提示",content:"系统开了个小差~",showCancel:!1}):(console.log(a),e.showModal({title:"提现接口提示",content:"系统繁忙",showCancel:!1}))}))},queryAllGiftsList:function(){var t=this;e.showLoading({title:"加载中"}),e.request({url:this.$Store.state.requestUrl+"/gifts/queryAllGiftsList",method:"POST",data:{openid:getApp().globalData.openid,currentPage:1,count:10,projectServerName:this.$Store.state.serverName}}).then((function(o){e.hideLoading();var n=s(o,2),a=n[0],i=n[1];i?(t.totalMoney=i.data.reply.totalMoney,t.total=i.data.reply.total,t.giftsMoney=i.data.reply.giftsMoney,t.$Store.state.haveTel=i.data.reply.phonenum,t.haveTel=i.data.reply.phonenum):(console.log(a),e.showModal({title:"扫码记录提示",content:"系统繁忙",showCancel:!1}))})).catch((function(t){e.hideLoading(),console.log(t)}))},getPhoneNum:function(t){var o=this;if(-1==t.detail.errMsg.indexOf("ok"))return this.authAgain=!0;getApp().globalData.sessionKey?e.request({url:this.$Store.state.sgUrl+"/api/decrypt",method:"POST",data:{provinceCode:"all",sessionKey:getApp().globalData.sessionKey,encryptedData:t.detail.encryptedData,iv:t.detail.iv}}).then((function(t){console.log(t);var n=s(t,2),a=n[0],i=n[1];i?i.data.data.decryptData.phoneNumber||-1==i.data.data.decryptData.indexOf("error")?(o.authAgain=!1,o.$Store.state.haveTel=i.data.data.decryptData.phoneNumber,o.haveTel=i.data.data.decryptData.phoneNumber,o.giveSpack()):(getApp().globalData.sessionKey="",e.removeStorage({key:"xcxOpenid",success:function(e){console.log(e)}}),e.showToast({icon:"none",title:"获取失败请重试"})):console.log(a)})).catch((function(e){console.log(e)})):this.getOpenid().then((function(n){return getApp().globalData.xcxOpenid=n.openid,getApp().globalData.sessionKey=n.session_key,e.request({url:o.$Store.state.sgUrl+"/api/decrypt",method:"POST",data:{provinceCode:"all",sessionKey:getApp().globalData.sessionKey,encryptedData:t.detail.encryptedData,iv:t.detail.iv}})})).then((function(e){console.log(e);var t=s(e,2),n=t[0],a=t[1];a?(o.$Store.state.haveTel=a.data.data.decryptData.phoneNumber,o.giveSpack()):console.log(n)})).catch((function(e){console.log(e)}))},giveSpack:function(t){var o=this;this.totalMoney>=1&&(getApp().globalData.hbopenid?this.tx():this.$Store.dispatch("getHbOpenid",t).then((function(n){console.log(n);var a=s(n,2),i=(a[0],a[1]);i?(getApp().globalData.hbopenid=i.data.hbopenid,o.tx()):(o.needTx=!0,e.navigateTo({url:"../tool/getOpenid/getOpenid?type=hbopenid&appid="+(t||o.$Store.state.payAppid)}))})))},queryAttention:function(){var t=this;e.request({url:this.$Store.state.wxUrl+"/wx3/uinfo2?openid="+getApp().globalData.openid+"&appid="+this.$Store.state.appid,method:"GET",complete:function(e){console.log("关注",e),1==e.data.subscribe?t.txSuc=!0:t.txAttention=!0}})}},components:{}};t.default=h}).call(this,o("543d")["default"])},d959:function(e,t,o){"use strict";(function(e){o("519c");n(o("66fd"));var t=n(o("562f"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("543d")["createPage"])}},[["d959","common/runtime","common/vendor"]]]);