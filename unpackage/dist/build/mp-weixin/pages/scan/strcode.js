(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/scan/strcode"],{"0876":function(e,t,o){"use strict";(function(e){o("519c");n(o("66fd"));var t=n(o("305d"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("543d")["createPage"])},"0c05":function(e,t,o){"use strict";o.r(t);var n=o("5a04"),a=o.n(n);for(var i in n)"default"!==i&&function(e){o.d(t,e,(function(){return n[e]}))}(i);t["default"]=a.a},"305d":function(e,t,o){"use strict";o.r(t);var n=o("3dce"),a=o("0c05");for(var i in a)"default"!==i&&function(e){o.d(t,e,(function(){return a[e]}))}(i);o("6bb4");var s,r=o("f0c5"),l=Object(r["a"])(a["default"],n["b"],n["c"],!1,null,"514afd26",null,!1,n["a"],s);t["default"]=l.exports},"3dce":function(e,t,o){"use strict";var n,a=function(){var e=this,t=e.$createElement;e._self._c},i=[];o.d(t,"b",(function(){return a})),o.d(t,"c",(function(){return i})),o.d(t,"a",(function(){return n}))},"5a04":function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(o("4795"));function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t,o,n,a,i,s){try{var r=e[i](s),l=r.value}catch(d){return void o(d)}r.done?t(l):Promise.resolve(l).then(n,a)}function s(e){return function(){var t=this,o=arguments;return new Promise((function(n,a){var s=e.apply(t,o);function r(e){i(s,n,a,r,l,"next",e)}function l(e){i(s,n,a,r,l,"throw",e)}r(void 0)}))}}function r(e,t){return p(e)||u(e,t)||d(e,t)||l()}function l(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function d(e,t){if(e){if("string"===typeof e)return c(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(o):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=new Array(t);o<t;o++)n[o]=e[o];return n}function u(e,t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e)){var o=[],n=!0,a=!1,i=void 0;try{for(var s,r=e[Symbol.iterator]();!(n=(s=r.next()).done);n=!0)if(o.push(s.value),t&&o.length===t)break}catch(l){a=!0,i=l}finally{try{n||null==r["return"]||r["return"]()}finally{if(a)throw i}}return o}}function p(e){if(Array.isArray(e))return e}var h=function(){o.e("components/back").then(function(){return resolve(o("5dd0"))}.bind(null,o)).catch(o.oe)},f={data:function(){return{needLocation:!1,againCLick:!1,noLocation:!1,imgUrl:getApp().globalData.imgUrl,latitude:"00",longitude:"00",sec:0,stop:!1,tel:"",yzcode:"",strcode:"",tipsText1:"",tipsText2:"",tooMany:!1,needVerifyCode:!1,first:!0,provinceCode:"",isOnLoad:!1,showPrivacy:!1,safeAreaTop:getApp().globalData.safeAreaTop?getApp().globalData.safeAreaTop+"px":"64rpx"}},onLoad:function(e){e.provinceCode&&"undefined"!=e.provinceCode&&(this.provinceCode=e.provinceCode,console.log(this.provinceCode),this.$Store.commit("setProjectSign",this.provinceCode),console.log(this.$Store.state.requestUrl,this.$Store.state.appid,this.$Store.state.payAppid),this.isOnLoad=!0)},onShow:function(){var t=this;if(!this.isOnLoad)return!1;getApp().globalData.vjfOpenid||this.$Store.dispatch("getVjfOpenid").then((function(t){var o=r(t,2),n=o[0],a=o[1];a?getApp().globalData.vjfOpenid=a.data.vjfOpenid:(console.log(n),e.navigateTo({url:"../tool/getOpenid/getOpenid?type=vjfOpenid"}))})),this.checkProvinceCode().then((function(o){if(console.log("省区关系是否变更",o),!o){getApp().globalData.openid="",getApp().globalData.hbopenid="";try{e.removeStorageSync("openid"),e.removeStorageSync("hbopenid")}catch(n){}}getApp().globalData.openid?(console.log(getApp().globalData.openid),t.init()):t.$Store.dispatch("getOpenid").then((function(o){var n=r(o,2),a=n[0],i=n[1];i?(getApp().globalData.openid=i.data.openid,t.init()):(console.log(a),e.navigateTo({url:"../tool/getOpenid/getOpenid?type=openid"}))}))})),e.getStorage({key:"readPrivacy"}).then((function(e){var o=r(e,2),n=(o[0],o[1]);n||(t.showPrivacy=!0)})),"00"==this.latitude&&this.$Store.dispatch("getLocation").then((function(e){var o=r(e,2),n=o[0],a=o[1];a?(console.log(a),t.latitude=a.latitude,t.longitude=a.longitude,getApp().globalData.latitude=a.latitude,getApp().globalData.longitude=a.longitude):(console.log(n),"getLocation:fail authorize no response"==n.errMsg||"getLocation:fail auth deny"==n.errMsg||"getLocation:fail:auth denied"==n.errMsg?t.needLocation=!0:t.noLocation=!0)}))},onReady:function(){},onHide:function(){this.stop=!0},onUnload:function(){this.stop=!0},methods:{readPrivacy:function(){this.showPrivacy=!1,e.setStorage({key:"readPrivacy",data:!0})},toPrivacy:function(){e.navigateTo({url:"../rule/privacy"})},checkProvinceCode:function(){var t=this;return s(n.default.mark((function o(){var a,i;return n.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(a={},getApp().globalData.xcxOpenid){o.next=8;break}return o.next=4,t.$Store.dispatch("getXcxOpenid");case 4:a=o.sent,getApp().globalData.xcxOpenid=a.openid,getApp().globalData.sessionKey=a.session_key,e.setStorage({key:"xcxOpenid",data:a});case 8:return o.next=10,t.$Store.dispatch("getProvinceCode",getApp().globalData.xcxOpenid);case 10:if(i=o.sent,console.log(i),i==t.provinceCode||void 0==t.provinceCode){o.next=18;break}return e.request({url:"".concat(t.$Store.state.isOnline?t.$Store.state.online.sgUrl:t.$Store.state.test.sgUrl,"/api/queryProvinceCode"),method:"GET",data:{xcxopenid:a.openid,provinceCode:t.provinceCode},complete:function(e){console.log("redis",e)}}),e.setStorage({key:"provinceCode",data:t.provinceCode}),o.abrupt("return",!1);case 18:return e.setStorage({key:"provinceCode",data:t.provinceCode}),o.abrupt("return",!0);case 20:case"end":return o.stop()}}),o)})))()},getOpenid:function(){var t=this;return s(n.default.mark((function o(){var a;return n.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,t.$Store.dispatch("getXcxOpenid");case 2:return a=o.sent,e.setStorage({key:"xcxOpenid",data:a}),o.abrupt("return",a);case 5:case"end":return o.stop()}}),o)})))()},openset:function(){this.againCLick=!0,e.openSetting()},cancel:function(){console.log("调接口"),this.againCLick=!0},closeTip:function(){var t=this;e.showModal({title:"温馨提示",content:"开启手机定位有机会获得更大的红包哦！确定不开启手机定位参与本次扫码活动吗？",cancelText:"先开定位",confirmColor:"#808080",confirmText:"直接参与",complete:function(o){console.log(o),o.confirm?t.noLocation=!1:e.switchTab({url:"../index/index"})}})},timeout:function(){var e=this,t=null;if(this.sec-=1,clearTimeout(t),this.sec<=0||this.stop)return this.sec=0;t=setTimeout((function(){e.timeout()}),1e3)},inputStr:function(e){this.strcode=e.detail.value},inputTel:function(e){this.tel=e.detail.value},inputYzcode:function(e){this.yzcode=e.detail.value},submsg:function(){if(this.tooMany)return!1;12!=this.strcode.length?e.showModal({title:"提示",content:"请输入正确的串码",showCancel:!1}):!/^1[0-9]{10}$/.test(this.tel)&&this.needVerifyCode?e.showModal({title:"提示",content:"请输入正确的手机号",showCancel:!1}):!/^[0-9]{4}$/.test(this.yzcode)&&this.needVerifyCode?e.showModal({title:"提示",content:"请输入正确的验证码",showCancel:!1}):this.sweep()},sweep:function(){var t=this;e.showLoading({title:"加载中",mask:!0}),e.request({url:this.$Store.state.requestUrl+"/sweep/serialCode",method:"POST",data:{openid:getApp().globalData.openid,vjifenOpenid:getApp().globalData.vjfOpenid,paOpenid:getApp().globalData.xcxOpenid,serialcode:this.strcode,verifycode:this.yzcode,phone:this.tel,longitude:this.longitude,latitude:this.latitude,headimgurl:this.$Store.state.hasUserInfo?this.$Store.state.userInfo.avatarUrl:"",nickname:this.$Store.state.hasUserInfo?this.$Store.state.userInfo.nickName:"",sex:this.$Store.state.hasUserInfo?this.$Store.state.userInfo.gender:"",projectServerName:this.$Store.state.serverName}}).then((function(o){e.hideLoading();var n=r(o,2),a=(n[0],n[1]);console.log(a),a?0==a.data.result.code?(t.$Store.state.total=!1,getApp().globalData.replyTime=a.data.replyTime,t.first=!1,getApp().globalData.reply=a.data.reply,getApp().globalData.result=a.data.result,a.data.reply&&a.data.reply.phonenum&&(t.$Store.state.haveTel=a.data.reply.phonenum),1==a.data.result.businessCode?(t.tipsText1="您输入的串码不存在",t.tipsText2="请确认是否输入正确",e.showModal({title:"提示",content:"串码不存在，请确认是否输入正确",showCancel:!1})):2==a.data.result.businessCode?(t.tipsText1="这个二维码已被扫",t.tipsText2="扫码时间："+a.data.reply.earnTime,e.showModal({title:"提示",content:"这个二维码已被扫",showCancel:!1})):3==a.data.result.businessCode?(t.tipsText1="活动已过期",t.tipsText2="好酒不等人，下次来早点哟",e.showModal({title:"提示",content:"活动已过期",showCancel:!1})):4==a.data.result.businessCode?(t.tipsText1="活动未开始",t.tipsText2="心急喝不了好酒！再等等哦",e.redirectTo({url:"../result/fail?bizcode="+a.data.result.businessCode})):5==a.data.result.businessCode?(t.tipsText1="活动已截止",t.tipsText2="好酒不等人，下次来早点哟",e.showModal({title:"提示",content:"活动已截止",showCancel:!1})):6==a.data.result.businessCode?(t.tipsText1="系统繁忙",t.tipsText2="稍等片刻，畅饮欢聚时刻",e.showModal({title:"提示",content:"系统繁忙",showCancel:!1})):-1==a.data.result.businessCode?(t.tipsText1="系统升级中",t.tipsText2="稍安勿躁，敬请关注",e.showModal({title:"提示",content:"系统升级中",showCancel:!1})):8==a.data.result.businessCode?(t.first=!0,e.showModal({title:"提示",content:"请输入验证码",showCancel:!1}),t.needVerifyCode=!0):9==a.data.result.businessCode?(t.first=!0,e.showModal({title:"提示",content:"您输入的验证码不正确，请重新输入！",showCancel:!1}),t.needVerifyCode=!0):10==a.data.result.businessCode&&(e.showModal({title:"提示",content:"您输入错误的次数太多了，明天再来试试吧！",showCancel:!1}),t.tooMany=!0,t.tipsText1="您输入的次数太多了",t.tipsText2="明天再来试试吧",t.needVerifyCode=!1),0==a.data.result.businessCode||11==a.data.result.businessCode?(getApp().globalData.isFromStrcode=!0,e.redirectTo({url:"../result/getcash?bizcode="+a.data.result.businessCode})):7==a.data.result.businessCode||21==a.data.result.businessCode?e.redirectTo({url:"../result/prize?bizcode="+a.data.result.businessCode}):12==a.data.result.businessCode||13==a.data.result.businessCode?(getApp().globalData.qrcode=encodeURIComponent("vj1.tv/"+t.provinceCode+"/"+t.strcode),e.redirectTo({url:"../result/getMsg?bizcode="+a.data.result.businessCode})):30==a.data.result.businessCode?e.redirectTo({url:"../result/verification"}):24==a.data.result.businessCode?e.redirectTo({url:"../yylx/yylx"}):e.redirectTo({url:"../result/fail?bizcode="+a.data.result.businessCode})):e.showModal({title:"串码提交提示",content:a.data.result.msg?a.data.result.msg:"系统开了个小差",showCancel:!1}):e.showModal({title:"串码提交提示",content:"系统繁忙",showCancel:!1})}))},init:function(){var t=this;e.request({url:this.$Store.state.requestUrl+"/sweep/getFailCount",method:"POST",data:{openid:getApp().globalData.openid,projectServerName:this.$Store.state.serverName}}).then((function(o){var n=r(o,2),a=(n[0],n[1]);console.log(a),a?0==a.data.result.code&&0==a.data.result.businessCode||(0==a.data.result.code&&2==a.data.result.businessCode?t.needVerifyCode=!0:0==a.data.result.code&&3==a.data.result.businessCode?(t.tooMany=!0,t.first=!1,t.tipsText1="您输入的次数太多了",t.tipsText2="明天再来试试吧"):e.showModal({title:"提示",content:a.data.result.msg?a.data.result.msg:"呜呜，系统开了个小差，请稍后重试！",showCancel:!1})):e.showModal({title:"串码init提示",content:"系统繁忙",showCancel:!1})}))},getVerifyCode:function(){var t=this;if(this.tooMany||0!=this.sec)return!1;/^1[0-9]{10}$/.test(this.tel)?(e.showLoading({title:"获取验证码",mask:!0}),e.request({url:this.$Store.state.requestUrl+"/user/getCaptcha",method:"POST",data:{phonenum:this.tel,sendtype:1,projectServerName:this.$Store.state.serverName}}).then((function(o){e.hideLoading();var n=r(o,2),a=(n[0],n[1]);a?0==a.data.result.code&&0==a.data.result.businessCode?(t.sec=60,t.timeout()):0==a.data.result.code&&2==a.data.result.businessCode?e.showModal({title:"提示",content:"您填写的手机号错误，发送验证码失败！",showCancel:!1}):e.showModal({title:"获取验证码提示",content:a.data.result.msg?a.data.result.msg:"呜呜，系统开了个小差，请稍后重试！",showCancel:!1}):e.showModal({title:"获取验证码提示",content:"系统繁忙",showCancel:!1})}))):e.showModal({title:"提示",content:"请输入正确的手机号",showCancel:!1})}},components:{goBack:h}};t.default=f}).call(this,o("543d")["default"])},"6bb4":function(e,t,o){"use strict";var n=o("cdfa"),a=o.n(n);a.a},cdfa:function(e,t,o){}},[["0876","common/runtime","common/vendor"]]]);